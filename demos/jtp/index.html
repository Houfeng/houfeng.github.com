<!doctype html>
<html>
	<head>
 		<title>jtp demo</title>
		<link rel="stylesheet" href="../../CodeMirror/lib/codemirror.css">
	    <script src="../../CodeMirror/lib/codemirror.js"></script>
	    <script src="../../CodeMirror/mode/xml/xml.js"></script>
	    <script src="../../CodeMirror/mode/javascript/javascript.js"></script>
	    <script src="../../CodeMirror/mode/css/css.js"></script>
	    <script src="../../CodeMirror/mode/htmlmixed/htmlmixed.js"></script>
	    <script src="../../CodeMirror/mode/jtp/jtp.js"></script>
	    <link rel="stylesheet" href="demo.css">
	    <script type="text/javascript" src="src/jtp.js"></script>
	</head>
	<body>
		<h1>jtp demo</h1>
	<div id="demoWrap">
		<table id="demeBox" >
			<tr>
				<td colspan="2" class="dataWrap">
				data:<br/>
				<textarea id="dataBox" placeholder='data ...'>
{name:'jtp dome',citys:['beijing','shanghai']}</textarea>
				</td>
			</tr>
			<tr>
				<td class="srcWrap">
					<br/>template:<br/>
					<textarea id="srcBox" placeholder='template source ...'>
<html>
	<head>
		<title><@ $(this.name) @></title>
	</head>
	<body>
		<@ $('hello jtp!') @>
		<h3>city list</h3>
		<ul>
			<@ for(var i in this.citys){ @>
				<li><@ $(this.citys[i]) @><li>
			<@ } @>
		</ul>
	</body>
</html></textarea>	
				</td>
				<td class="dstWrap">
					<br/>result:<br/>
					<textarea id="dstBox" placeholder='result ...' readonly='readonly'></textarea>
				</td>
			</tr>
		</table>
	</div>
 		<script type="text/javascript">
 			//获取页面元素
 		 	var $get=function (id) {
 				return document.getElementById(id);
 			};
 			//编辑器选项
 			var editorOption={
 				lineNumbers: true,
 				lineWrapping:false,
		        matchBrackets: true,
		        mode: "application/x-jtp",
		        indentUnit: 4,
		        indentWithTabs: true,
		        enterMode: "keep",
		        autoMatchParens:true,
		        tabMode: "shift",
		        width:" 300px"
 			};
 			//初始化编辑器
 			editorOption.onChange=function () {
		        $excute();
		    };
		    editorOption.onScroll=function(){
		    	var srcInfo=srcEditor.getScrollInfo();
		    	var dstInfo=dstEditor.getScrollInfo();
		    	dstEditor.scrollTo(dstInfo.width*srcInfo.x/(srcInfo.width-427),dstInfo.height*srcInfo.y/(srcInfo.height-302));
		    };
		    var srcEditor = CodeMirror.fromTextArea($get('srcBox'),editorOption);
		    editorOption.onScroll=null;
		    editorOption.onChange=null;
		    var dstEditor = CodeMirror.fromTextArea($get('dstBox'),editorOption);
		    editorOption.onChange=function () {
		        $excute();
		    };
		    editorOption.lineNumbers=false;
		    var dataEditor = CodeMirror.fromTextArea($get('dataBox'),editorOption);
		    //执行
 			var $excute=function () {
 				try{
 					var data=eval('('+dataEditor.getValue()+')');
 					var fn=jtp.compile(srcEditor.getValue());
 					dstEditor.setValue(fn(data));
 				}catch(ex){}
 			};
 			$excute();
 		</script>
	</body>
</html>